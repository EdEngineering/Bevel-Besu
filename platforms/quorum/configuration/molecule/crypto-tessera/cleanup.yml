##############################################################################################
#  Copyright Accenture. All Rights Reserved.
#
#  SPDX-License-Identifier: Apache-2.0
##############################################################################################

---
- name: Cleanup after Molecule Test
  hosts: localhost
  connection: local
  gather_facts: no
  tasks:

  #This task deletes the temporarily created build directory
  - name: Delete temp build directory
    file:
      path: "./build"
      state: absent
    
  #This task deletes the temporarily created shared directory
  - name: Delete temp roles folder
    file:
      path: "{{ playbook_dir }}/../../shared"
      state: absent

  #This task deletes the temporarily created test directory
  - name: Delete the test directory
    file:
      path: "./test"
      state: absent

  #This task deletes the temporarily copied openssl.conf file
  - name: Delete openssl.conf
    file:
      path: "openssl.conf"
      state: absent

  #This task deletes the test directory
  - name: Delete the test directory
    file:
      path: "{{ playbook_dir }}/roles"
      state: absent

  #This task deletes the temporarily created molecule folder
  - name: Delete the molecule folder
    file:
      path: /tmp/molecule
      state: absent

  #This task prunes the empty docker files
  - name: Prune empty docker volumes
    shell: |
      docker volume prune -f
